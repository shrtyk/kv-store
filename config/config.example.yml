# Environment: "dev" or "production"
# In "dev" mode, logging is more verbose.
env: "production"

# Store configuration
store:
  # Maximum size of a key in bytes.
  max_key: 1024
  # Maximum size of a value in bytes.
  max_val: 1024
  # Number of shards for the in-memory map.
  # A higher number can reduce lock contention under high concurrency.
  # Use a power of 2 for better performance.
  shards_count: 128

# Shards configuration
shards:
  # How often shards supervisor will start health check
  check_frequency: 30s
  # Sparse ratio needed to to trigger rebuild (current shard size <= all time max size * sparse ration)
  sparse_ratio: 0.5
  # Min operations to trigger shard rebuild
  min_operations_until_rebuild: 2000
  # Min delete operation to trigger shard rebuild
  min_deletes: 500
  # Amount of workers which will rebuild shards in background
  rebuild_workers_count: 4

# Write-Ahead Log (WAL) configuration
transactional_logger:
  # Path to the WAL file.
  log_file_name: "data/wal/kv.log"
  # Maximum size of the WAL file in bytes before a snapshot is triggered.
  log_size_bytes: 10485760 # 10MB
  # Interval at which the WAL is fsync'd to disk.
  fsync_in: 100ms
  # Number of retries for the final fsync on graceful shutdown.
  fsync_retries: 3
  # Delay between fsync retries on graceful shutdown.
  fsync_retry_in: 500ms

# Snapshots configuration
snapshots:
  # Directory to store snapshot files.
  snapshots_dir: "data/snapshots"
  # Maximum number of snapshot files to keep. Older snapshots will be deleted.
  max_snapshots: 2

# Http configuration:
http:
  # Host for the http server
  host: localhost
  # Port for the http server
  port: 16700
  # Http server idle timeout
  idle_timeout: 5s
  # Http server write timeout
  write_timeout: 10s
  # Http server read timeout
  read_timeout: 10s

# Grpc configuration:
grpc:
  # Port for the grpc server
  port: 16701
